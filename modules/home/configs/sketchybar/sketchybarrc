# Define colors from Rusty theme (matching EWW)
export BG="0xd90f0f0f"
export PANEL="0xcc1d1f21"
export FG="0xffc5c8c6"
export ACCENT="0xffde935f"
export SELECTION="0xff373b41"
export RED="0xffcc6666"
export ORANGE="0xffde935f"
export GREEN="0xffb5bd68"
export YELLOW="0xfff0c674"
export BLUE="0xff81a2be"
export MAGENTA="0xffb294bb"
export CYAN="0xff8abeb7"

# Icons
export APPLE=" "
export FONT="SF Pro"

# Get the directory where this script is located
CONFIG_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Configure bar (matching EWW background)
sketchybar --bar height=28 \
                position=top \
                padding_left=6 \
                padding_right=6 \
                color=$BG \
                blur_radius=0 \
                drawing=on

# Configure default values (matching EWW styling)
sketchybar --default icon.font="Hack Nerd Font:Bold:13.0" \
                    icon.color=$FG \
                    icon.padding_left=10 \
                    icon.padding_right=3 \
                    label.font="SF Pro:Regular:13.0" \
                    label.color=$FG \
                    label.padding_left=3 \
                    label.padding_right=10 \
                    padding_left=2 \
                    padding_right=2 \
                    blur_radius=0 \
                    background.color=$PANEL \
                    background.corner_radius=24 \
                    background.height=22 \
                    background.drawing=on

# Apple menu
source "$CONFIG_DIR/plugins/apple_menu.sh"

# Add aerospace events
sketchybar --add event aerospace_workspace_change

# Initialize workspaces after aerospace is ready (background process)
"$CONFIG_DIR/plugins/init_workspaces.sh" &

# Right side items (added in reverse order since they stack right-to-left)
# Clock item (rightmost)
sketchybar --add item clock right \
          --set clock update_freq=10 \
                      icon="󰥔" \
                      icon.color=$ACCENT \
                      script="$CONFIG_DIR/plugins/clock.sh"

# Volume item
sketchybar --add item volume right \
          --set volume script="$CONFIG_DIR/plugins/volume.sh" \
                       icon.color=$MAGENTA \
          --subscribe volume volume_change

# Battery item
sketchybar --add item battery right \
          --set battery update_freq=30 \
                        icon.color=$YELLOW \
                        script="$CONFIG_DIR/plugins/battery.sh" \
          --subscribe battery system_woke power_source_change

# Memory (RAM)
sketchybar --add item ram right \
          --set ram icon="" \
                    icon.color=$GREEN \
                    update_freq=2 \
                    script="$CONFIG_DIR/plugins/ram.sh"

# CPU (leftmost of right side)
sketchybar --add item cpu right \
          --set cpu icon="󰻠" \
                    icon.color=$CYAN \
                    update_freq=2 \
                    script="$CONFIG_DIR/plugins/cpu.sh"

# Media item (now playing)
sketchybar --add item media left \
          --set media script="$CONFIG_DIR/plugins/media.sh" \
                      label.max_chars=40 \
                      scroll_texts=off \
                      update_freq=5 \
                      updates=on \
          --subscribe media media_change

# Update the bar
sketchybar --update
